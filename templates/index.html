{% extends "base.html" %}
{% block title %}VehicleAI â€” Dashboard{% endblock %}

{% block content %}
<!-- HERO -->
<section style="max-width:1300px; margin:auto; padding:0 24px;">
  <div class="hero-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:60px; align-items:center; min-height:calc(100vh - 64px);">
    <div>
      <div class="hero-eyebrow">â¬¡ AI-Powered System</div>
      <h1 class="font-display fw-700" style="font-size:clamp(36px,5.5vw,68px); line-height:1; letter-spacing:-1px;">
        PREDICT.<br>
        <span style="color:var(--accent)">PREVENT.</span><br>
        PROTECT.
      </h1>
      <p class="text-muted" style="font-size:16px; margin:24px 0 32px; line-height:1.7; max-width:480px;">
        ML-based vehicle predictive maintenance system. Detect engine faults before failure, predict service costs, and receive intelligent maintenance recommendations.
      </p>
      <div style="display:flex; gap:12px; flex-wrap:wrap;">
        <a href="/engine"  class="btn btn-primary">âš¡ Engine Scan</a>
        <a href="/service" class="btn btn-ghost">ðŸ”§ Service Prediction</a>
        <a href="/analytics" class="btn btn-ghost">ðŸ“Š Analytics</a>
      </div>
      <div style="display:flex; gap:20px; margin-top:36px; flex-wrap:wrap;">
        <div>
          <div class="font-display fw-700" style="font-size:28px;">{{ stats.engine_samples | default(19535) | int | string | replace('000', 'K') }}+</div>
          <div class="text-xs text-muted" style="letter-spacing:1px;">ENGINE RECORDS</div>
        </div>
        <div style="width:1px; background:var(--border);"></div>
        <div>
          <div class="font-display fw-700" style="font-size:28px;">{{ stats.service_samples | default(1139) }}</div>
          <div class="text-xs text-muted" style="letter-spacing:1px;">SERVICE RECORDS</div>
        </div>
        <div style="width:1px; background:var(--border);"></div>
        <div>
          <div class="font-display fw-700" style="font-size:28px;">4</div>
          <div class="text-xs text-muted" style="letter-spacing:1px;">ML MODELS</div>
        </div>
        <div style="width:1px; background:var(--border);"></div>
        <div>
          <div class="font-display fw-700" style="font-size:28px;">16</div>
          <div class="text-xs text-muted" style="letter-spacing:1px;">ANALYSIS GRAPHS</div>
        </div>
      </div>
    </div>

    <!-- Live Engine Mock Viz -->
    <div class="hero-viz" style="background:var(--bg2); border:1px solid var(--border2); border-radius:12px; padding:28px; position:relative; overflow:hidden;">
      <div style="position:absolute; inset:-50%; background:radial-gradient(circle at center, rgba(88,166,255,.07) 0%, transparent 60%); pointer-events:none;"></div>
      <div style="font-family:'Space Mono',monospace; font-size:10px; color:var(--accent); letter-spacing:2px; margin-bottom:16px;">LIVE ENGINE DIAGNOSTICS</div>
      <div class="engine-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
        <div class="eng-metric" style="background:var(--bg3); border:1px solid var(--border); border-radius:6px; padding:14px;">
          <div style="font-size:10px; color:var(--text3); letter-spacing:1px; text-transform:uppercase;">Engine RPM</div>
          <div class="mono text-accent" style="font-size:24px; margin-top:4px;" id="live-rpm">1,840</div>
        </div>
        <div class="eng-metric" style="background:var(--bg3); border:1px solid var(--border); border-radius:6px; padding:14px;">
          <div style="font-size:10px; color:var(--text3); letter-spacing:1px; text-transform:uppercase;">Oil Pressure</div>
          <div class="mono text-accent" style="font-size:24px; margin-top:4px;" id="live-oil">3.42 bar</div>
        </div>
        <div class="eng-metric" style="background:var(--bg3); border:1px solid var(--border); border-radius:6px; padding:14px;">
          <div style="font-size:10px; color:var(--text3); letter-spacing:1px; text-transform:uppercase;">Coolant Temp</div>
          <div class="mono text-accent" style="font-size:24px; margin-top:4px;" id="live-cool">82.1 Â°C</div>
        </div>
        <div class="eng-metric" style="background:var(--bg3); border:1px solid var(--border); border-radius:6px; padding:14px;">
          <div style="font-size:10px; color:var(--text3); letter-spacing:1px; text-transform:uppercase;">Fuel Pressure</div>
          <div class="mono text-accent" style="font-size:24px; margin-top:4px;" id="live-fuel">14.5 bar</div>
        </div>
      </div>
      <!-- Health bar -->
      <div style="margin-top:16px;">
        <div style="display:flex; justify-content:space-between; font-size:11px; color:var(--text2); margin-bottom:6px;">
          <span>SYSTEM HEALTH</span>
          <span id="live-health-pct" class="text-success">87%</span>
        </div>
        <div style="background:var(--bg3); border-radius:100px; height:8px; overflow:hidden;">
          <div id="live-health-bar" style="height:100%; border-radius:100px; width:87%; background:linear-gradient(90deg, var(--danger) 0%, var(--warning) 40%, var(--success) 80%); transition:width .8s ease;"></div>
        </div>
      </div>
      <div style="margin-top:14px; padding:10px 14px; background:rgba(63,185,80,.08); border:1px solid rgba(63,185,80,.25); border-radius:6px; display:flex; align-items:center; gap:8px;">
        <span class="pulse pulse-anim"></span>
        <span class="font-display fw-700" style="font-size:13px; letter-spacing:2px; color:var(--success);">ENGINE NORMAL</span>
      </div>
    </div>
  </div>
</section>

<!-- STATS ROW -->
<section class="section" style="border-top:1px solid var(--border);">
  <h2 class="section-title">System Overview</h2>
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-val">{{ stats.engine_samples | default(19535) }}<span class="stat-unit"></span></div>
      <div class="stat-label">Engine Data Points Analyzed</div>
    </div>
    <div class="stat-card" style="--accent:var(--danger)">
      <div class="stat-val" style="color:var(--danger);">{{ stats.fault_pct | default(63.1) }}<span class="stat-unit" style="font-size:18px; color:var(--text2);">%</span></div>
      <div class="stat-label">Engine Fault Rate in Dataset</div>
    </div>
    <div class="stat-card">
      <div class="stat-val">â‚¹{{ stats.avg_cost | default(3200) }}</div>
      <div class="stat-label">Average Service Cost</div>
    </div>
    <div class="stat-card">
      <div class="stat-val">{{ stats.service_samples | default(1139) }}</div>
      <div class="stat-label">Service Records Trained On</div>
    </div>
    <div class="stat-card">
      <div class="stat-val">14</div>
      <div class="stat-label">Maintenance Items Predicted</div>
    </div>
    <div class="stat-card">
      <div class="stat-val" style="color:var(--success);">~87<span class="stat-unit" style="font-size:16px;">%</span></div>
      <div class="stat-label">Cost Prediction RÂ² Score</div>
    </div>
  </div>
</section>

<!-- FEATURE CARDS -->
<section class="section" style="border-top:1px solid var(--border);">
  <h2 class="section-title">Core Modules</h2>
  <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:20px;">

    <div class="card" style="border-color:rgba(88,166,255,.3); position:relative; overflow:hidden;">
      <div style="position:absolute; top:0; right:0; width:80px; height:80px; background:radial-gradient(circle, rgba(88,166,255,.15) 0%, transparent 70%);"></div>
      <div style="font-size:32px; margin-bottom:14px;">âš¡</div>
      <div class="font-display fw-700" style="font-size:20px; letter-spacing:1px; color:var(--text);">Engine Condition Scanner</div>
      <p class="text-muted text-sm" style="margin-top:8px; line-height:1.6;">Input 6 real-time engine parameters. Our Gradient Boosting classifier instantly predicts if your engine has a fault condition.</p>
      <div style="margin-top:16px; display:flex; gap:8px; flex-wrap:wrap;">
        <span class="badge badge-accent">Classification</span>
        <span class="badge badge-accent">Real-time</span>
        <span class="badge badge-accent">6 Parameters</span>
      </div>
      <a href="/engine" class="btn btn-primary" style="margin-top:20px; width:100%;">Open Engine Scan â†’</a>
    </div>

    <div class="card" style="border-color:rgba(63,185,80,.3); position:relative; overflow:hidden;">
      <div style="position:absolute; top:0; right:0; width:80px; height:80px; background:radial-gradient(circle, rgba(63,185,80,.15) 0%, transparent 70%);"></div>
      <div style="font-size:32px; margin-bottom:14px;">ðŸ”§</div>
      <div class="font-display fw-700" style="font-size:20px; letter-spacing:1px; color:var(--text);">Service Cost Predictor</div>
      <p class="text-muted text-sm" style="margin-top:8px; line-height:1.6;">Enter vehicle details and mileage to predict service cost and exactly which 14 maintenance items need replacement.</p>
      <div style="margin-top:16px; display:flex; gap:8px; flex-wrap:wrap;">
        <span class="badge badge-success">Regression</span>
        <span class="badge badge-success">Multi-label</span>
        <span class="badge badge-success">14 Items</span>
      </div>
      <a href="/service" class="btn btn-primary" style="margin-top:20px; width:100%; background:rgba(63,185,80,.2); border-color:var(--success); color:var(--success);">Open Service Predictor â†’</a>
    </div>

    <div class="card" style="border-color:rgba(188,140,255,.3); position:relative; overflow:hidden;">
      <div style="position:absolute; top:0; right:0; width:80px; height:80px; background:radial-gradient(circle, rgba(188,140,255,.15) 0%, transparent 70%);"></div>
      <div style="font-size:32px; margin-bottom:14px;">ðŸ“Š</div>
      <div class="font-display fw-700" style="font-size:20px; letter-spacing:1px; color:var(--text);">ML Analytics Dashboard</div>
      <p class="text-muted text-sm" style="margin-top:8px; line-height:1.6;">16 detailed graphs â€” ROC curves, confusion matrices, learning curves, feature importance, residual analysis, and more.</p>
      <div style="margin-top:16px; display:flex; gap:8px; flex-wrap:wrap;">
        <span class="badge" style="background:rgba(188,140,255,.15); color:var(--purple); border:1px solid rgba(188,140,255,.3);">16 Graphs</span>
        <span class="badge" style="background:rgba(188,140,255,.15); color:var(--purple); border:1px solid rgba(188,140,255,.3);">Full Analysis</span>
      </div>
      <a href="/analytics" class="btn btn-primary" style="margin-top:20px; width:100%; background:rgba(188,140,255,.2); border-color:var(--purple); color:var(--purple);">View Analytics â†’</a>
    </div>
  </div>
</section>

<!-- ML PIPELINE -->
<section class="section" style="border-top:1px solid var(--border);">
  <h2 class="section-title">ML Pipeline</h2>
  <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:12px;">
    {% for step in [
      ('01', 'Data Ingestion', 'Load engine & service datasets'),
      ('02', 'Preprocessing', 'Scale, encode, train-test split'),
      ('03', 'Model Training', 'RF, GBM, KNN, Decision Tree'),
      ('04', 'Evaluation', 'Accuracy, ROC-AUC, RÂ², MAE'),
      ('05', 'Deployment', 'Flask REST API + Web UI'),
      ('06', 'Prediction', 'Real-time inference & alerts'),
    ] %}
    <div style="background:var(--bg2); border:1px solid var(--border); border-radius:8px; padding:16px;">
      <div class="mono text-accent" style="font-size:11px; margin-bottom:8px;">{{ step[0] }}</div>
      <div class="font-display fw-700" style="font-size:15px; color:var(--text);">{{ step[1] }}</div>
      <div class="text-sm text-muted" style="margin-top:4px;">{{ step[2] }}</div>
    </div>
    {% endfor %}
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
// Animate live metrics
const metrics = [
  {id:'live-rpm',  vals:['1,840','2,150','1,620','1,990','1,750'], suffix:''},
  {id:'live-oil',  vals:['3.42','2.98','3.71','3.15','3.55'], suffix:' bar'},
  {id:'live-cool', vals:['82.1','79.4','84.6','81.0','83.2'], suffix:' Â°C'},
  {id:'live-fuel', vals:['14.5','13.8','15.2','14.1','15.6'], suffix:' bar'},
];
let tick = 0;
setInterval(() => {
  tick++;
  metrics.forEach(m => {
    const el = document.getElementById(m.id);
    if (el) el.textContent = m.vals[tick % m.vals.length] + m.suffix;
  });
  const health = [87,92,78,95,83][tick % 5];
  const hel = document.getElementById('live-health-pct');
  const bar = document.getElementById('live-health-bar');
  if(hel) hel.textContent = health + '%';
  if(bar) bar.style.width = health + '%';
}, 2500);
</script>
{% endblock %}

{% extends "base.html" %}
{% block title %}Analytics â€” VehicleAI{% endblock %}

{% block content %}
<div class="page-hero">
  <div class="overline">Module 03 â€” Model Analytics</div>
  <h1>ML <span>Analytics</span> Dashboard</h1>
  <p>16 detailed training graphs showing model performance, feature importance, error analysis, and data distributions for both the engine and service prediction models.</p>
</div>

<div class="section">
  <!-- Model KPIs -->
  <h2 class="section-title">Model Performance KPIs</h2>
  <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:16px; margin-bottom:40px;">
    <div class="stat-card" style="--accent:var(--accent);">
      <div class="text-xs text-muted" style="margin-bottom:6px; letter-spacing:1px;">ENGINE MODEL</div>
      <div class="stat-val" style="font-size:28px; color:var(--accent);">66.3<span class="stat-unit">%</span></div>
      <div class="stat-label">Test Accuracy (Gradient Boosting)</div>
    </div>
    <div class="stat-card">
      <div class="text-xs text-muted" style="margin-bottom:6px; letter-spacing:1px;">CROSS-VALIDATION</div>
      <div class="stat-val" style="font-size:28px; color:var(--success);">66.7<span class="stat-unit">%</span></div>
      <div class="stat-label">5-Fold CV Mean Score</div>
    </div>
    <div class="stat-card">
      <div class="text-xs text-muted" style="margin-bottom:6px; letter-spacing:1px;">COST MODEL RÂ²</div>
      <div class="stat-val" style="font-size:28px; color:var(--purple);">0.868</div>
      <div class="stat-label">Service Cost Regression</div>
    </div>
    <div class="stat-card">
      <div class="text-xs text-muted" style="margin-bottom:6px; letter-spacing:1px;">COST MAE</div>
      <div class="stat-val" style="font-size:28px; color:var(--warning);">â‚¹404</div>
      <div class="stat-label">Mean Absolute Error</div>
    </div>
    <div class="stat-card">
      <div class="text-xs text-muted" style="margin-bottom:6px; letter-spacing:1px;">ITEM ACCURACY</div>
      <div class="stat-val" style="font-size:28px; color:var(--success);">97.3<span class="stat-unit">%</span></div>
      <div class="stat-label">Avg Maintenance Item Accuracy</div>
    </div>
    <div class="stat-card">
      <div class="text-xs text-muted" style="margin-bottom:6px; letter-spacing:1px;">TRAINING SIZE</div>
      <div class="stat-val" style="font-size:28px; color:var(--accent);">20K+</div>
      <div class="stat-label">Total Training Records</div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('engine')">âš¡ Engine Model (8 graphs)</button>
    <button class="tab-btn" onclick="switchTab('service')">ðŸ”§ Service Model (8 graphs)</button>
  </div>

  <!-- Engine Graphs -->
  <div class="tab-content active" id="tab-engine">
    <div style="margin-bottom:20px;">
      <p class="text-muted text-sm">Engine condition classification â€” trained on 19,535 records. Compares Random Forest, Gradient Boosting, Decision Tree, and K-Nearest Neighbors classifiers.</p>
    </div>
    <div class="graph-grid">
      {% for g in graphs_eng %}
      <div class="graph-card" onclick="openModal('{{ url_for('static', filename='images/graphs/' + g.file) }}', '{{ g.title }}', '{{ g.desc }}')">
        <img src="{{ url_for('static', filename='images/graphs/' + g.file) }}"
             alt="{{ g.title }}" class="graph-img" loading="lazy">
        <div class="graph-info">
          <div class="graph-title">{{ g.title }}</div>
          <div class="graph-desc">{{ g.desc }}</div>
          <div style="margin-top:8px;"><span class="badge badge-accent" style="font-size:10px;">Click to expand</span></div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Service Graphs -->
  <div class="tab-content" id="tab-service">
    <div style="margin-bottom:20px;">
      <p class="text-muted text-sm">Service cost regression & maintenance item multi-label classification â€” trained on 1,139 service records from multiple brands, regions, and vehicle types.</p>
    </div>
    <div class="graph-grid">
      {% for g in graphs_svc %}
      <div class="graph-card" onclick="openModal('{{ url_for('static', filename='images/graphs/' + g.file) }}', '{{ g.title }}', '{{ g.desc }}')">
        <img src="{{ url_for('static', filename='images/graphs/' + g.file) }}"
             alt="{{ g.title }}" class="graph-img" loading="lazy">
        <div class="graph-info">
          <div class="graph-title">{{ g.title }}</div>
          <div class="graph-desc">{{ g.desc }}</div>
          <div style="margin-top:8px;"><span class="badge badge-success" style="font-size:10px;">Click to expand</span></div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Models Summary -->
  <div style="margin-top:40px; border-top:1px solid var(--border); padding-top:32px;">
    <h2 class="section-title">Models Trained</h2>
    <table class="data-table">
      <thead>
        <tr>
          <th>Model</th><th>Task</th><th>Algorithm</th><th>Metric</th><th>Score</th><th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="font-display fw-700">Engine Classifier</td>
          <td>Binary Classification</td>
          <td class="mono" style="font-size:12px;">Gradient Boosting</td>
          <td>Test Accuracy</td>
          <td class="text-accent font-display fw-700">66.29%</td>
          <td><span class="badge badge-success">Active</span></td>
        </tr>
        <tr>
          <td class="font-display fw-700">Engine (Random Forest)</td>
          <td>Binary Classification</td>
          <td class="mono" style="font-size:12px;">Random Forest (150 trees)</td>
          <td>Test Accuracy</td>
          <td class="text-accent font-display fw-700">65.70%</td>
          <td><span class="badge badge-accent">Trained</span></td>
        </tr>
        <tr>
          <td class="font-display fw-700">Engine (Decision Tree)</td>
          <td>Binary Classification</td>
          <td class="mono" style="font-size:12px;">Decision Tree depth=10</td>
          <td>Test Accuracy</td>
          <td class="font-display fw-700">63.76%</td>
          <td><span class="badge badge-accent">Trained</span></td>
        </tr>
        <tr>
          <td class="font-display fw-700">Engine (KNN)</td>
          <td>Binary Classification</td>
          <td class="mono" style="font-size:12px;">KNN k=7</td>
          <td>Test Accuracy</td>
          <td class="font-display fw-700">63.32%</td>
          <td><span class="badge badge-accent">Trained</span></td>
        </tr>
        <tr>
          <td class="font-display fw-700">Service Cost Predictor</td>
          <td>Regression</td>
          <td class="mono" style="font-size:12px;">Random Forest (200 trees)</td>
          <td>RÂ² Score</td>
          <td class="text-success font-display fw-700">0.8676</td>
          <td><span class="badge badge-success">Active</span></td>
        </tr>
        <tr>
          <td class="font-display fw-700">Maintenance Item (Ã—14)</td>
          <td>Multi-Label Classification</td>
          <td class="mono" style="font-size:12px;">Random Forest (100 trees)</td>
          <td>Avg Accuracy</td>
          <td class="text-success font-display fw-700">97.3%</td>
          <td><span class="badge badge-success">Active</span></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- MODAL -->
<div id="graph-modal" style="display:none; position:fixed; inset:0; z-index:9999; background:rgba(0,0,0,.85); backdrop-filter:blur(6px); padding:40px 20px; overflow-y:auto;" onclick="closeModal(event)">
  <div style="max-width:1000px; margin:auto; background:var(--bg2); border:1px solid var(--border2); border-radius:12px; overflow:hidden;" onclick="event.stopPropagation()">
    <div style="padding:16px 20px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--border);">
      <div>
        <div class="font-display fw-700" style="font-size:16px; letter-spacing:1px;" id="modal-title">â€”</div>
        <div class="text-sm text-muted" id="modal-desc">â€”</div>
      </div>
      <button onclick="document.getElementById('graph-modal').style.display='none'"
              style="background:none; border:1px solid var(--border2); color:var(--text2); padding:6px 12px; border-radius:4px; cursor:pointer; font-size:18px;">âœ•</button>
    </div>
    <img id="modal-img" src="" alt="" style="width:100%; display:block;">
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function switchTab(name) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  document.getElementById('tab-' + name).classList.add('active');
  event.target.classList.add('active');
}

function openModal(src, title, desc) {
  document.getElementById('modal-img').src   = src;
  document.getElementById('modal-title').textContent = title;
  document.getElementById('modal-desc').textContent  = desc;
  document.getElementById('graph-modal').style.display = 'block';
}
function closeModal(e) {
  if (e.target.id === 'graph-modal') document.getElementById('graph-modal').style.display = 'none';
}
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') document.getElementById('graph-modal').style.display = 'none';
});
</script>
{% endblock %}
